// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;t=null;n=null;s=null;e=null;i=null;r=null;O={};p=[];l=null;y=0;f="all";o={like:"/instagram/like/"};w=function(e){e==null&&(e=[]);return _.each(e,function(e){return O[e]=_.template($("#"+e+"_tmpl").html())})};c=function(e){e==null&&(e="all");return $.getJSON("/instagrams/"+e+"/"+y)};m=function(){y++;return $.getJSON("/instagrams/"+f+"/"+y)};u=function(e,n){var r;p=e.instagrams;r=0;return async.each(e.instagrams,function(e,n){var i;e.index=r++;i=new Image;i.onload=function(){i.width>0&&t.append(O.instagram(e));return n()};i.onerror=function(){return n()};return i.src=e.thumbnail},function(){if(typeof n=="function"?n(null):void 0)return n()})};N=function(e){return t.fadeOut(300,function(){t.empty();return u(e,function(){return t.fadeIn(300)})})};d=function(e){n.removeClass("video").html(O.modal(e));n.modal();return setTimeout(function(){$.modal.resize();return E()},150)};E=function(){return $(".share").on("click",function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;t=$(this);if(t.hasClass("facebook")){f=t.data("url");u=encodeURI(t.data("name"));r=t.data("id");s=encodeURI(t.data("description"));o=encodeURI(t.data("message"));i=encodeURI(t.data("caption"));a=f;n="http://www.facebook.com/dialog/feed?app_id="+r+"&link="+f+"&picture="+f+"/images/fb-img.jpg&name="+u+"&description="+s+"&caption="+i+"&message="+o+"&redirect_uri="+a;t.attr("href",n);return!0}if(t.hasClass("twitter")){d=t.data("url");h=encodeURI(t.data("message"));h+=" %2523"+t.data("hash");l=encodeURI(t.data("name"));c=encodeURI(d);p="https://api.awe.sm/url/share?key=6b64ad61db021bfa99e5466b5ced348da77f42bb1a54f141c79500e6ead37117&tool=kwBldW&v=3&channel=twitter&campaign="+l+"&destination=http%3A%2F%2Ftwitter.com%2Fintent%2Ftweet%3Ftext%3D"+h+"%2BAWESM_URL&url="+c;t.attr("href",p);return!0}})};v=function(e){return $.ajax({url:o.like+e,type:"GET",dataType:"json"})};A=function(e){var t;return(t=$.jStorage.get(e))!=null?t:!1};S=function(){return $("#slides").superslides({slide_speed:500,pagination:!1,hashchange:!1,scrollable:!1,play:!1})};x=function(){$(".toggle-view").on("click",function(e){var t;t=$(this);e.preventDefault();return $("body").toggleClass("split")});return $(".toggle-top").on("click",function(e){var t;e.preventDefault();t=$(this);if(t.hasClass("tracklist")){$("body").removeClass("info-inview directors-inview");$("body").toggleClass("top-drawer tracklist-inview")}if(t.hasClass("info")){$("body").removeClass("directors-inview tracklist-inview");$("body").toggleClass("top-drawer info-inview")}if(t.hasClass("directors")){$("body").removeClass("info-inview tracklist-inview");$("body").toggleClass("top-drawer directors-inview")}if(t.hasClass("close"))return $("body").removeClass("top-drawer info-inview directors-inview tracklist-inview")})};T=function(){var e;s=$("#videos");e=s.find(".video").map(function(e){var t;t=this.getAttribute("data-url");$(this).find("iframe").attr("src",t);return t}).get();$("#slides").find("iframe").each(function(){var e;e=Froogaloop(this);return e.addEvent("ready",function(){e.api("setLoop",1);e.addEvent("finish",C);e.addEvent("play",L);return e.addEvent("pause",k)})});return g()};h=function(){var e,t;e=$("#slides").find(".current");t=e.find("iframe");return Froogaloop(t.get(0))};C=function(e){return $("#slides").superslides("animate","next")};L=function(t){e.html("#"+t);i.html(""+t);return r.removeClass("current").filter("[data-for="+t+"]").addClass("current")};k=function(e){};a=function(e,t){t==null&&(t=null);return $("#slides").find("iframe").each(function(){var n;n=Froogaloop(this);return n.api(e,t)})};b=function(){var e;e=h();return e.api("play")};g=function(){return $(".volume").on("click",function(e){var t,n;e.preventDefault();t=$(this);t.toggleClass("mute");n=h();if(t.hasClass("mute")){n.api("setVolume",0);return t.html("&#x1F508;")}n.api("setVolume",1);return t.html("&#x1F50A;")})};$(document).ready(function(){t=$("#instagrams");n=$("#modal");s=$("#videos");e=$("#hashtag").find("h2");i=$("#track-title");r=$(".note","#top");E();S();T();x();w(["instagram","modal"]);c().then(u);$(".filters").on("click",".filter",function(e){var t,n;e.preventDefault();t=$(this);n=t.data("filter");if(n!==f){y=0;return c(n).then(N)}});t.on("click",".instagram",function(e){var t,n,r;t=$(this);n=(r=p[t.data("index")])!=null?r:null;n.liked=A(n._id);if(n)return d(n)});$(".continue").on("click",function(e){e.preventDefault();return $("#intro").fadeOut(500)});$(".album-mini").powerTip({placement:"w",mouseOnToPopup:!0});$(".tooltip").powerTip({placement:"n"});n.on("click",".like",function(e){var t,n,r;t=$(this);if(!t.hasClass("liked")){n=t.data("id");r=v(n);return r.done(function(e){if(e.error==null){$.jStorage.set(n,!0);return t.addClass("liked")}})}});$("#load-more").click(function(e){e.preventDefault();return m().then(u)});$(".fullscreen").click(function(e){e.preventDefault();return $(document).toggleFullScreen()});$(".embed").zclip({path:"javascripts/ZeroClipboard.swf",copy:$(".embedcode").val(),afterCopy:function(){return $(".embed").html("Copied!")}});$(document).on("animated.slides",function(e){a("pause");return b()});if(typeof __instagram!="undefined"&&__instagram!==null)return setTimeout(function(){insta.liked=A(__instagram._id);return d(__instagram)},500)})}).call(this);